#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö NFT —Å–∏—Å—Ç–µ–º—ã
"""

import os
import sys
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from sqlalchemy.orm import sessionmaker
from server.database_sqlite import engine, User, NFTItem, Case, CaseItem
from uuid import uuid4

# –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
SessionLocal = sessionmaker(bind=engine)
db = SessionLocal()

def create_test_nft_data():
    """–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è NFT —Å–∏—Å—Ç–µ–º—ã"""
    
    # –°–æ–∑–¥–∞–µ–º NFT –ø—Ä–µ–¥–º–µ—Ç—ã
    nft_items = [
        # –ê–≤–∞—Ç–∞—Ä—ã
        {
            "id": str(uuid4()),
            "name": "–ö–æ—Å–º–æ–Ω–∞–≤—Ç",
            "description": "–†–µ–¥–∫–∏–π –∞–≤–∞—Ç–∞—Ä –∫–æ—Å–º–æ–Ω–∞–≤—Ç–∞",
            "image_url": "https://via.placeholder.com/200x200/4338ca/ffffff?text=–ö–æ—Å–º–æ–Ω–∞–≤—Ç",
            "rarity": "rare",
            "nft_type": "avatar",
            "stars_value": 500
        },
        {
            "id": str(uuid4()),
            "name": "–ö–∏–±–µ—Ä–ø–∞–Ω–∫",
            "description": "–≠–ø–∏—á–µ—Å–∫–∏–π –∞–≤–∞—Ç–∞—Ä –≤ —Å—Ç–∏–ª–µ –∫–∏–±–µ—Ä–ø–∞–Ω–∫",
            "image_url": "https://via.placeholder.com/200x200/7c3aed/ffffff?text=–ö–∏–±–µ—Ä–ø–∞–Ω–∫",
            "rarity": "epic",
            "nft_type": "avatar",
            "stars_value": 1000
        },
        {
            "id": str(uuid4()),
            "name": "–ó–æ–ª–æ—Ç–æ–π –†–æ–±–æ—Ç",
            "description": "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∑–æ–ª–æ—Ç–æ–π —Ä–æ–±–æ—Ç",
            "image_url": "https://via.placeholder.com/200x200/f59e0b/ffffff?text=–ó–æ–ª–æ—Ç–æ–π+–†–æ–±–æ—Ç",
            "rarity": "legendary",
            "nft_type": "avatar",
            "stars_value": 2500
        },
        
        # –ö–∞—Ä—Ç—ã
        {
            "id": str(uuid4()),
            "name": "–û–≥–Ω–µ–Ω–Ω–∞—è –ö–∞—Ä—Ç–∞",
            "description": "–û–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –æ–≥–Ω–µ–Ω–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º",
            "image_url": "https://via.placeholder.com/200x200/ef4444/ffffff?text=–û–≥–æ–Ω—å",
            "rarity": "common",
            "nft_type": "card",
            "stars_value": 100
        },
        {
            "id": str(uuid4()),
            "name": "–õ–µ–¥—è–Ω–∞—è –ö–∞—Ä—Ç–∞",
            "description": "–ù–µ–æ–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –ª–µ–¥—è–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º",
            "image_url": "https://via.placeholder.com/200x200/3b82f6/ffffff?text=–õ–µ–¥",
            "rarity": "uncommon",
            "nft_type": "card",
            "stars_value": 250
        },
        {
            "id": str(uuid4()),
            "name": "–ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è –ö–∞—Ä—Ç–∞",
            "description": "–†–µ–¥–∫–∞—è –∫–∞—Ä—Ç–∞ —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º",
            "image_url": "https://via.placeholder.com/200x200/a855f7/ffffff?text=–ú–æ–ª–Ω–∏—è",
            "rarity": "rare",
            "nft_type": "card",
            "stars_value": 750
        },
        
        # –°—Ç–∏–∫–µ—Ä—ã
        {
            "id": str(uuid4()),
            "name": "–°–º–∞–π–ª–∏–∫",
            "description": "–û–±—ã—á–Ω—ã–π –≤–µ—Å–µ–ª—ã–π —Å–º–∞–π–ª–∏–∫",
            "image_url": "https://via.placeholder.com/200x200/22c55e/ffffff?text=üòä",
            "rarity": "common",
            "nft_type": "sticker",
            "stars_value": 50
        },
        {
            "id": str(uuid4()),
            "name": "–ö—Ä—É—Ç–æ–π –ß–µ—Ä–µ–ø",
            "description": "–≠–ø–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–∫–µ—Ä —á–µ—Ä–µ–ø–∞",
            "image_url": "https://via.placeholder.com/200x200/6b7280/ffffff?text=üíÄ",
            "rarity": "epic",
            "nft_type": "sticker",
            "stars_value": 800
        },
        
        # –†–∞–º–∫–∏
        {
            "id": str(uuid4()),
            "name": "–ü—Ä–æ—Å—Ç–∞—è –†–∞–º–∫–∞",
            "description": "–û–±—ã—á–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è",
            "image_url": "https://via.placeholder.com/200x200/94a3b8/ffffff?text=–†–∞–º–∫–∞",
            "rarity": "common",
            "nft_type": "frame",
            "stars_value": 150
        },
        {
            "id": str(uuid4()),
            "name": "–ó–æ–ª–æ—Ç–∞—è –†–∞–º–∫–∞",
            "description": "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –∑–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞",
            "image_url": "https://via.placeholder.com/200x200/fbbf24/ffffff?text=–ó–æ–ª–æ—Ç–æ",
            "rarity": "legendary",
            "nft_type": "frame",
            "stars_value": 3000
        }
    ]
    
    # –î–æ–±–∞–≤–ª—è–µ–º NFT –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –±–∞–∑—É
    for item_data in nft_items:
        nft_item = NFTItem(**item_data)
        db.add(nft_item)
    
    # –°–æ–∑–¥–∞–µ–º –∫–µ–π—Å—ã
    cases = [
        {
            "id": str(uuid4()),
            "name": "–°—Ç–∞—Ä—Ç–æ–≤—ã–π –ö–µ–π—Å",
            "description": "–ò–¥–µ–∞–ª—å–Ω—ã–π –∫–µ–π—Å –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ —Å –±–∞–∑–æ–≤—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏",
            "image_url": "https://via.placeholder.com/300x300/3b82f6/ffffff?text=–°—Ç–∞—Ä—Ç–æ–≤—ã–π+–ö–µ–π—Å",
            "price_stars": 200,
            "is_active": True
        },
        {
            "id": str(uuid4()),
            "name": "–ü—Ä–µ–º–∏—É–º –ö–µ–π—Å",
            "description": "–ö–µ–π—Å —Å —Ä–µ–¥–∫–∏–º–∏ –∏ —ç–ø–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏",
            "image_url": "https://via.placeholder.com/300x300/7c3aed/ffffff?text=–ü—Ä–µ–º–∏—É–º+–ö–µ–π—Å",
            "price_stars": 500,
            "is_active": True
        },
        {
            "id": str(uuid4()),
            "name": "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ö–µ–π—Å",
            "description": "–°–∞–º—ã–µ —Ä–µ–¥–∫–∏–µ –∏ —Ü–µ–Ω–Ω—ã–µ NFT –ø—Ä–µ–¥–º–µ—Ç—ã",
            "image_url": "https://via.placeholder.com/300x300/f59e0b/ffffff?text=–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π+–ö–µ–π—Å",
            "price_stars": 1000,
            "is_active": True
        }
    ]
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–µ–π—Å—ã –≤ –±–∞–∑—É
    case_objects = []
    for case_data in cases:
        case = Case(**case_data)
        db.add(case)
        case_objects.append(case)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ID
    db.commit()
    
    # –°–æ–∑–¥–∞–µ–º —Å–≤—è–∑–∏ –∫–µ–π—Å–æ–≤ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
    case_items = [
        # –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–µ–π—Å - –æ–±—ã—á–Ω—ã–µ –∏ –Ω–µ–æ–±—ã—á–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
        {"case_id": case_objects[0].id, "nft_item_id": nft_items[3]["id"], "drop_chance": 30.0, "min_value": 90, "max_value": 110},  # –û–≥–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞
        {"case_id": case_objects[0].id, "nft_item_id": nft_items[4]["id"], "drop_chance": 25.0, "min_value": 200, "max_value": 300},  # –õ–µ–¥—è–Ω–∞—è –∫–∞—Ä—Ç–∞
        {"case_id": case_objects[0].id, "nft_item_id": nft_items[6]["id"], "drop_chance": 25.0, "min_value": 40, "max_value": 60},  # –°–º–∞–π–ª–∏–∫
        {"case_id": case_objects[0].id, "nft_item_id": nft_items[8]["id"], "drop_chance": 20.0, "min_value": 120, "max_value": 180},  # –ü—Ä–æ—Å—Ç–∞—è —Ä–∞–º–∫–∞
        
        # –ü—Ä–µ–º–∏—É–º –∫–µ–π—Å - —Ä–µ–¥–∫–∏–µ –∏ —ç–ø–∏—á–µ—Å–∫–∏–µ
        {"case_id": case_objects[1].id, "nft_item_id": nft_items[0]["id"], "drop_chance": 25.0, "min_value": 450, "max_value": 550},  # –ö–æ—Å–º–æ–Ω–∞–≤—Ç
        {"case_id": case_objects[1].id, "nft_item_id": nft_items[1]["id"], "drop_chance": 15.0, "min_value": 900, "max_value": 1100},  # –ö–∏–±–µ—Ä–ø–∞–Ω–∫
        {"case_id": case_objects[1].id, "nft_item_id": nft_items[5]["id"], "drop_chance": 30.0, "min_value": 650, "max_value": 850},  # –ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è –∫–∞—Ä—Ç–∞
        {"case_id": case_objects[1].id, "nft_item_id": nft_items[7]["id"], "drop_chance": 20.0, "min_value": 700, "max_value": 900},  # –ö—Ä—É—Ç–æ–π —á–µ—Ä–µ–ø
        {"case_id": case_objects[1].id, "nft_item_id": nft_items[4]["id"], "drop_chance": 10.0, "min_value": 200, "max_value": 300},  # –õ–µ–¥—è–Ω–∞—è –∫–∞—Ä—Ç–∞
        
        # –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å - —ç–ø–∏—á–µ—Å–∫–∏–µ –∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ
        {"case_id": case_objects[2].id, "nft_item_id": nft_items[2]["id"], "drop_chance": 10.0, "min_value": 2000, "max_value": 3000},  # –ó–æ–ª–æ—Ç–æ–π —Ä–æ–±–æ—Ç
        {"case_id": case_objects[2].id, "nft_item_id": nft_items[9]["id"], "drop_chance": 15.0, "min_value": 2500, "max_value": 3500},  # –ó–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞
        {"case_id": case_objects[2].id, "nft_item_id": nft_items[1]["id"], "drop_chance": 25.0, "min_value": 900, "max_value": 1100},  # –ö–∏–±–µ—Ä–ø–∞–Ω–∫
        {"case_id": case_objects[2].id, "nft_item_id": nft_items[7]["id"], "drop_chance": 30.0, "min_value": 700, "max_value": 900},  # –ö—Ä—É—Ç–æ–π —á–µ—Ä–µ–ø
        {"case_id": case_objects[2].id, "nft_item_id": nft_items[0]["id"], "drop_chance": 20.0, "min_value": 450, "max_value": 550},  # –ö–æ—Å–º–æ–Ω–∞–≤—Ç
    ]
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑–∏ –∫–µ–π—Å–æ–≤ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
    for item_data in case_items:
        case_item = CaseItem(**item_data)
        db.add(case_item)
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    test_user = User(
        telegram_id="123456789",
        username="test_user",
        first_name="Test",
        stars_balance=2000,  # –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        total_games=0,
        wins=0
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    existing_user = db.query(User).filter(User.telegram_id == "123456789").first()
    if not existing_user:
        db.add(test_user)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    db.commit()
    print("‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ NFT —Å–∏—Å—Ç–µ–º—ã —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ!")
    print(f"üì¶ –°–æ–∑–¥–∞–Ω–æ {len(nft_items)} NFT –ø—Ä–µ–¥–º–µ—Ç–æ–≤")
    print(f"üéÅ –°–æ–∑–¥–∞–Ω–æ {len(cases)} –∫–µ–π—Å–æ–≤")
    print(f"üîó –°–æ–∑–¥–∞–Ω–æ {len(case_items)} —Å–≤—è–∑–µ–π –∫–µ–π—Å-–ø—Ä–µ–¥–º–µ—Ç")
    print("üë§ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –±–∞–ª–∞–Ω—Å–æ–º 2000 –∑–≤–µ–∑–¥")

def cleanup_test_data():
    """–£–¥–∞–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ"""
    db.query(CaseItem).delete()
    db.query(Case).delete()
    db.query(NFTItem).delete()
    # –ù–µ —É–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ–ª—å–∫–æ –æ–±–Ω—É–ª—è–µ–º –±–∞–ª–∞–Ω—Å
    test_user = db.query(User).filter(User.telegram_id == "123456789").first()
    if test_user:
        test_user.stars_balance = 0
    db.commit()
    print("üßπ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã")

if __name__ == "__main__":
    if len(sys.argv) > 1 and sys.argv[1] == "cleanup":
        cleanup_test_data()
    else:
        create_test_nft_data()
    
    db.close()
