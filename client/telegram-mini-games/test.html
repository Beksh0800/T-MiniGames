<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∞ –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
            line-clamp: 3;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .news-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .news-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .source-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
        }
        
        .source-bbc { background-color: #fee2e2; color: #991b1b; }
        .source-reddit { background-color: #fef3c7; color: #92400e; }
        .source-habr { background-color: #ecfdf5; color: #166534; }
        .source-default { background-color: #f3f4f6; color: #374151; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º -->
        <header class="gradient-bg shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="text-center">
                    <div class="flex items-center justify-center mb-4">
                        <div class="bg-white/20 p-3 rounded-full mr-4">
                            <i class="fas fa-newspaper text-white text-3xl"></i>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-bold text-white">
                            –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
                        </h1>
                    </div>
                    <p class="text-white/90 text-lg">
                        –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                    </p>
                    <div class="mt-6 flex justify-center">
                        <button onclick="loadNews()" id="refresh-btn" 
                                class="bg-white/20 backdrop-blur-sm text-white px-6 py-3 rounded-full font-medium hover:bg-white/30 transition-all duration-300 flex items-center space-x-2">
                            <i class="fas fa-sync-alt" id="refresh-icon"></i>
                            <span>–û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="stats">
                <div class="bg-white rounded-xl p-6 shadow-md">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-globe text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
                            <p class="text-2xl font-bold text-gray-900" id="sources-count">3</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-md">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-newspaper text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">–ù–æ–≤–æ—Å—Ç–µ–π</p>
                            <p class="text-2xl font-bold text-gray-900" id="news-count">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-md">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-clock text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">–û–±–Ω–æ–≤–ª–µ–Ω–æ</p>
                            <p class="text-sm font-bold text-gray-900" id="last-update">–ù–∏–∫–æ–≥–¥–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="loading" class="text-center py-16">
                <div class="inline-flex items-center justify-center w-16 h-16 mb-6">
                    <div class="w-12 h-12 border-4 border-purple-200 border-t-purple-600 rounded-full animate-spin"></div>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏</h3>
                <p class="text-gray-500">–°–æ–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...</p>
            </div>
            
            <!-- –û—à–∏–±–∫–∞ -->
            <div id="error" class="hidden max-w-2xl mx-auto">
                <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                    <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-red-800 mb-2">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</h3>
                    <p class="text-red-600 mb-6" id="error-message"></p>
                    <button onclick="loadNews()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-medium">
                        <i class="fas fa-redo mr-2"></i>
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </div>
            </div>

            <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
            <div id="news-container" class="hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h2>
                    <div class="w-24 h-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full"></div>
                </div>
                
                <div id="news-grid" class="grid gap-8 md:grid-cols-1 lg:grid-cols-2">
                    <!-- –ù–æ–≤–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ -->
                <div class="text-center mt-12">
                    <button onclick="loadMoreNews()" id="load-more-btn" 
                            class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-4 rounded-full font-medium hover:from-purple-700 hover:to-blue-700 transition-all duration-300 transform hover:scale-105">
                        <i class="fas fa-plus mr-2"></i>
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ –Ω–æ–≤–æ—Å—Ç–∏
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let currentPage = 1;
        let allNews = [];

        async function loadNews(page = 1) {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const newsContainer = document.getElementById('news-container');
            const errorMessage = document.getElementById('error-message');
            const refreshIcon = document.getElementById('refresh-icon');

            if (page === 1) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                loading.classList.remove('hidden');
                error.classList.add('hidden');
                newsContainer.classList.add('hidden');
                allNews = [];
                currentPage = 1;
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            refreshIcon.classList.add('animate-spin');

            try {
                const response = await fetch(`${API_BASE_URL}/news?page=${page}&limit=20`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (page === 1) {
                    loading.classList.add('hidden');
                }
                
                if (data.news && data.news.length > 0) {
                    if (page === 1) {
                        allNews = data.news;
                    } else {
                        allNews = [...allNews, ...data.news];
                    }
                    
                    renderNews(allNews);
                    updateStats(allNews.length);
                    newsContainer.classList.remove('hidden');
                    
                    // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É "–∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" –µ—Å–ª–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π
                    const loadMoreBtn = document.getElementById('load-more-btn');
                    if (!data.hasMore) {
                        loadMoreBtn.style.display = 'none';
                    } else {
                        loadMoreBtn.style.display = 'block';
                    }
                } else {
                    throw new Error('–ù–æ–≤–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }
            } catch (err) {
                if (page === 1) {
                    loading.classList.add('hidden');
                    errorMessage.textContent = err.message;
                    error.classList.remove('hidden');
                }
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', err);
            } finally {
                refreshIcon.classList.remove('animate-spin');
            }
        }

        async function loadMoreNews() {
            currentPage++;
            await loadNews(currentPage);
        }

        function updateStats(newsCount) {
            document.getElementById('news-count').textContent = newsCount;
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('ru-RU');
        }

        function renderNews(newsItems) {
            const container = document.getElementById('news-grid');
            container.innerHTML = '';

            newsItems.forEach((item, index) => {
                const newsCard = document.createElement('div');
                newsCard.className = 'news-card bg-white rounded-xl shadow-md hover:shadow-xl border border-gray-100 overflow-hidden fade-in';
                newsCard.style.animationDelay = `${index * 0.1}s`;
                
                const date = item.date ? new Date(item.date).toLocaleDateString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';

                const source = getSourceName(item.source);
                const sourceClass = getSourceClass(item.source);

                newsCard.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <span class="source-badge ${sourceClass}">
                                <i class="fas fa-globe mr-1"></i>
                                ${source}
                            </span>
                            <span class="text-sm text-gray-500 flex items-center">
                                <i class="fas fa-clock mr-1"></i>
                                ${date}
                            </span>
                        </div>
                        
                        <h2 class="text-xl font-bold text-gray-900 leading-tight mb-3 hover:text-purple-600 transition-colors">
                            ${item.title}
                        </h2>
                        
                        ${item.description ? `
                            <p class="text-gray-600 mb-6 line-clamp-3 leading-relaxed">
                                ${item.description.replace(/<[^>]*>/g, '')}
                            </p>
                        ` : ''}
                        
                        <div class="flex items-center justify-between">
                            ${item.author ? `
                                <div class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-user mr-1"></i>
                                    <span>${item.author}</span>
                                </div>
                            ` : '<div></div>'}
                            
                            <a href="${item.link}" target="_blank" rel="noopener noreferrer" 
                               class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-sm font-medium rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-300 transform hover:scale-105">
                                <span class="mr-2">–ß–∏—Ç–∞—Ç—å</span>
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                    </div>
                `;

                container.appendChild(newsCard);
            });
        }

        function getSourceName(sourceUrl) {
            try {
                const url = new URL(sourceUrl);
                const hostname = url.hostname.replace('www.', '');
                
                if (hostname.includes('bbc')) return 'BBC News';
                if (hostname.includes('reddit')) return 'Reddit';
                if (hostname.includes('habr')) return 'Habr';
                
                return hostname;
            } catch {
                return sourceUrl;
            }
        }

        function getSourceClass(sourceUrl) {
            try {
                const url = new URL(sourceUrl);
                const hostname = url.hostname.replace('www.', '');
                
                if (hostname.includes('bbc')) return 'source-bbc';
                if (hostname.includes('reddit')) return 'source-reddit';
                if (hostname.includes('habr')) return 'source-habr';
                
                return 'source-default';
            } catch {
                return 'source-default';
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadNews();
    </script>
</body>
</html>
